<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Team mecha_02 (Edge_Case) Term Project: Team mecha_02 (Edge_Case) Term Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Team mecha_02 (Edge_Case) Term Project
   </div>
   <div id="projectbrief">This project contains files used for Edge_Case&#39;s ME 405 Term Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Team mecha_02 (Edge_Case) Term Project </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="soft_des"></a>
Software Design</h1>
<p>This project consists of files used to control the turret system for team Edge_Case's Learn by Dueling project. This code runs on an STM32L476RG microcontroller, where various electrical components (Panning axis motor, MLX90640 Thermal Infrared Camera, and Linear Actuator) are controlled. <br  />
 The software utilizes a time-based scheduler to run three tasks <br  />
 (<code><a class="el" href="turret__driver_8py.html" title="This file contains code that controls the panning axis motor.">turret_driver.py</a></code> , <code><a class="el" href="thermal__camera_8py.html" title="This file contains code that initializes, receives, processes, and sends thermal camera data to the r...">thermal_camera.py</a></code> , and <code><a class="el" href="actuator__flywheel_8py.html" title="This file contains code that controls the linear actuator and flywheel system present in the design.">actuator_flywheel.py</a></code>) cooperatively of each other. Their functions and code design are described below. To learn more about the rest of the system (Mechanical and Electrical Hardware), along with its outcomes, please refer to the main GitHub page: <a href="https://github.com/dijonm53/mecha_02-Term-Project">https://github.com/dijonm53/mecha_02-Term-Project</a></p>
<h1><a class="anchor" id="code"></a>
Original Code</h1>
<p>Here are the main files used to control this system, along with their system diagrams. These files are made by team Edge_Case. One thing to note is that for almost all of these files, the pins that the components utilize are initialized within their respective files.</p>
<h2><a class="anchor" id="therm"></a>
Thermal Camera</h2>
<p><code><a class="el" href="thermal__camera_8py.html" title="This file contains code that initializes, receives, processes, and sends thermal camera data to the r...">thermal_camera.py</a></code> is used to acquire/process data from the MLX90640 <br  />
 Thermal Infrared Camera. During the duel, the task repeatedly tries to obtain an image from the camera, using a function within <code><a class="el" href="mlx__cam_8py.html" title="RAW VERSION This version uses a stripped down MLX90640 driver which produces only raw data,...">mlx_cam.py</a></code> . After receiving an image, the task will then process that image to obtain a 'degrees from target' reading to then send to the task that controls the panning axis. However, this degree will only be sent to that task after 5 seconds. While testing this functionality, we noticed that the initial degree from the sensor is almost always inaccurate when compared to where the target actually is. That is why the code is set up in a way to continuously read data from the sensor until 5 seconds is up. The code structure, or Finite-State Machine (FSM), is shown below: </p><div class="image">
<img src="Sensor_FSM.jpg" alt=""/>
</div>
<h2><a class="anchor" id="tur"></a>
Turret Driver</h2>
<p><code><a class="el" href="turret__driver_8py.html" title="This file contains code that controls the panning axis motor.">turret_driver.py</a></code> is used to control the panning axis motor for the system. Before the duel begins, the turret must be facing away from the target. Once the duel begins, the task rotates the turret 180 degrees clockwise to face the end of the table. In order to do this, <code><a class="el" href="closed__loop__controller_8py.html" title="This file contains code that will implement the associated motor_driver and encoder_reader ....">closed_loop_controller.py</a></code> is run with a setpoint equal to around 180 degrees. The task then waits until it gets a degree value from the sensor task. After receiving this data, the task then converts the value into a meaningful motor encoder setpoint, which is then sent to <code><a class="el" href="closed__loop__controller_8py.html" title="This file contains code that will implement the associated motor_driver and encoder_reader ....">closed_loop_controller.py</a></code> to run. After turning to the frozen target, the task sends an indication (an integer '1') to the linear actuator task to shoot the bullet. The FSM for this task is shown below: </p><div class="image">
<img src="Turret_FSM.jpg" alt=""/>
</div>
<h2><a class="anchor" id="act"></a>
Actuator Driver</h2>
<p><code><a class="el" href="actuator__flywheel_8py.html" title="This file contains code that controls the linear actuator and flywheel system present in the design.">actuator_flywheel.py</a></code> is used to control the motion of the linear actuator. Initially (when the duel begins), the actuator is idle for arbitrary period of time (around 1-2 seconds). After this idle state, the linear actuator is pushed out just enough to stop the bullet right before it touches the flywheel. Because the actuator is very slow, we thought that priming the actuator before shooting will speed up the process of shooting. After this, the actuator waits until it gets a signal from <code><a class="el" href="turret__driver_8py.html" title="This file contains code that controls the panning axis motor.">turret_driver.py</a></code> to shoot the push the bullet into the spinning flywheel. One thing to note is that because this linear actuator does not come equipped with an encoder, many of these functions are purely time-based. This behavior this discussed further in the 'Takeaways' section in the main GitHub page. The FSM for this task is shown below: </p><div class="image">
<img src="Actuator_FSM.jpg" alt=""/>
</div>
<p><br  />
</p>
<h2><a class="anchor" id="motor_cont"></a>
Motor Controller File</h2>
<p><code><a class="el" href="closed__loop__controller_8py.html" title="This file contains code that will implement the associated motor_driver and encoder_reader ....">closed_loop_controller.py</a></code> is used to run a step-response (Proportional controller) for a given motor. This file is primarily used by the <code><a class="el" href="turret__driver_8py.html" title="This file contains code that controls the panning axis motor.">turret_driver.py</a></code> task. This file was taken from a previous lab assignment that we completed, and further modified to fit better for this project. When this file is called, a step-response is run until completed, with a given gain and setpoint value. After it has completed, the file sends an indication to whatever file called it (in this case, <code><a class="el" href="turret__driver_8py.html" title="This file contains code that controls the panning axis motor.">turret_driver.py</a></code>) that the step- response has been complete. After this is done, all necessary values are reset and waits until run again. The FSM for this task is shown below: </p><div class="image">
<img src="Controller_FSM.jpg" alt=""/>
</div>
<h1><a class="anchor" id="imp_code"></a>
Imported/Modified Code</h1>
<p>Here are the files imported from a library (made by the instructor) that was used to make this system run. One of these files has been modified slightly for the purposes of this project</p>
<h2><a class="anchor" id="imp"></a>
Imported Code</h2>
<p><code><a class="el" href="cotask_8py.html" title="This file contains classes to run cooperatively scheduled tasks in a multitasking system.">cotask.py</a></code> and <code><a class="el" href="task__share_8py.html" title="This file contains classes which allow tasks to share data without the risk of data corruption by int...">task_share.py</a></code> were imported to use for this project. These files are unmodified.</p>
<h2><a class="anchor" id="mod"></a>
Modified Code</h2>
<p><code><a class="el" href="mlx__cam_8py.html" title="RAW VERSION This version uses a stripped down MLX90640 driver which produces only raw data,...">mlx_cam.py</a></code> has largely been unchanged from its previous state, except for the function <code>get_csv</code> . Originally, after running this function, it would print a 32x24 pixel grid of numbers ranging from 0-99 in a CSV style format, representative of what the camera sees. The higher the number, the higher the temperature. Now, the function has been modified to return the column in that pixel grid representative of the highest total. If a column of values has the highest total, it is likely that the target is in that area.</p>
<h1><a class="anchor" id="oth_code"></a>
Other Code</h1>
<p><code><a class="el" href="motor__driver_8py.html" title="This file contains code which when run through Nucleo L476RG board will initialize and run a connecte...">motor_driver.py</a></code> and <code><a class="el" href="encoder__reader_8py.html" title="This file contains code that records and prints the total position rotated by the encoder,...">encoder_reader.py</a></code> are files made by us to run the motor and read encoder data, respectively. These are used by various files within the system to perform certain functions. @ <a class="el" href="step__control_8py.html" title="Run step-response output for motor/encoder and plot the results.">step_control.py</a> was used to tune the gain values for the motor controller task.</p>
<h1><a class="anchor" id="tsk_dia"></a>
Task Diagram</h1>
<p>Shown below is how our three main tasks (<code><a class="el" href="turret__driver_8py.html" title="This file contains code that controls the panning axis motor.">turret_driver.py</a></code> , <code><a class="el" href="thermal__camera_8py.html" title="This file contains code that initializes, receives, processes, and sends thermal camera data to the r...">thermal_camera.py</a></code> , and <code><a class="el" href="actuator__flywheel_8py.html" title="This file contains code that controls the linear actuator and flywheel system present in the design.">actuator_flywheel.py</a></code>) cooperatively worked with each other. </p><div class="image">
<img src="Task_Diagram.jpg" alt=""/>
</div>
 </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
